\documentclass[tikz]{standalone}
\usepackage{tikz}
\usetikzlibrary{arrows, calc, patterns, decorations.pathmorphing, fit, positioning, shapes.misc}

% Draw the data structures for a single thread block 
% #1 - grid size [mm]
% #2 - pad size [mm]
% #3 - max cols
% #4 - num rows
% #5 - row lengths
\newcommand{\drawBlock}[5]{%
    \pgfmathtruncatemacro{\matrixWidth}{#1 * #3}
    \pgfmathtruncatemacro{\matrixHeight}{#1 * #4}
    \pgfmathtruncatemacro{\lastCol}{#3 - 1}
    \pgfmathtruncatemacro{\lastRow}{#4 - 1}
    
    % Draw ragged matrix grid
    \draw[step=#1 mm] (0, 0) grid (\matrixWidth mm, \matrixHeight mm);
    
    % Draw row length grid
    \draw[step=#1 mm, shift={({-#2 mm - (2 * #1 mm)}, 0)}] 
        (0, 0) 
        grid 
        (#1 * 2mm, \matrixHeight mm);
        
    % Draw row padding
    \foreach[count=\i] \r in {#5} {
        \draw[pattern=north west lines] 
            ({#1 * \r mm}, {(\i - 1) * #1 mm}) 
            rectangle 
            ({#1 * #3 mm}, {\i * #1 mm});
    }
    
    % Draw threads
    \foreach \i in {0,...,\lastCol} {
        \draw [<-,decorate,decoration={snake,amplitude=0.75mm,pre length=1mm}]
            ({(\i + 0.5) * #1 mm}, {\matrixHeight mm + 2mm})
            --
            +(0, 10mm);
    }
    
    % Label each presynaptic index and row length
    \foreach \i in {0,...,\lastRow} {
        \node at ({-#2 mm - (1.5 * #1 mm)}, {((\lastRow - \i) + 0.5) * #1 mm}){$i_{\i}$};
        \node at ({-#2 mm - (0.5 * #1 mm)}, {((\lastRow - \i) + 0.5) * #1 mm}){$l_{\i}$};
    }
}
\begin{document}
\begin{tikzpicture}
    \def\grid{8}
    \def\pad{5}
    \def\maxCols{4}
    \def\numRows{4}
%     \def\numPost{10}
%     \pgfmathtruncatemacro{\postOffset}{\grid * -2.25}
%     \pgfmathtruncatemacro{\lastPost}{\numPost - 1}
%     % Draw postsynaptic neuron grid
%     \draw[step=\grid mm, shift={(\postOffset mm, {-\pad mm - \grid mm})}]
%         (0, 0)
%         grid
%         (\grid * \numPost mm, \grid mm);
    % Label postsynaptic inputs
%     \foreach \j in {0,...,\lastPost} {
%         \node at ({\postOffset mm + ((\j + 0.5) * \grid mm)}, {-\pad mm - (\grid mm / 2)}){$I_{s_{\j}}$};
%     }
%     
    %--------------------------------------------------------
    % Block 1
    %--------------------------------------------------------
    \node (block_1) at (0, 0){
        \begin{tikzpicture}
            \drawBlock{\grid}{\pad}{\maxCols}{\numRows}{4, 4, 4, 4}{}
        \end{tikzpicture}
    };

    %--------------------------------------------------------
    % Block 2
    %--------------------------------------------------------
    \node (block_2) at ({(\grid mm * (\maxCols + 2) ) + (3mm *\pad)}, 0){
        \begin{tikzpicture}
            \drawBlock{\grid}{\pad}{\maxCols}{\numRows}{3, 4, 1, 2}{}
        \end{tikzpicture}
    };
\end{tikzpicture}
\end{document}